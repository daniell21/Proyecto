
  <%if current_user.role == "client" %>
  <h1>Registro de Pagos</h1>
  <%end%>

  <%if current_user.role != "client" %>
  <h1>Cuentas por Cobrar</h1>
    <div class="row">
      <div class="col-xs-4">
        <!--Busqueda de clientes por nombre-->
        <%= hidden_field_tag :direction, params[:search]%>
        <%= hidden_field_tag :sort, params[:sort]%>
        <label>Nombre</label>
        <%= form_tag accountreceivables_path, :method => 'get' do %>
          <p>
            <%= text_field_tag :search, params[:search], class: 'form-control'  %>
            <%= submit_tag "Buscar Cuenta", :name => nil, :class => 'btn btn-default btn'   %>
          </p>
        <% end %>
      </div> 
      <div class="col-xs-4">
        <%= form_tag import_accountreceivables_path, multipart: true do %>
          <%= file_field_tag :file %>
          <%= submit_tag "Importar Cuentas", :class => 'btn btn-default btn' %>
        <%end%>
      </div>   
    </div>
    <div class="row">
      <div class="col-xs-6">
        <p>
          Exportar Cuenttas:
          <%= link_to "CSV", accountreceivables_path(format: "csv") %> |
          <%= link_to "Excel", accountreceivables_path(format: "xls") %>
        </p>
      </div>
    </div>
  <%end%> 
<table class="table table-striped table-hover">
 
    <tr>
    <%if current_user.role != "client"%>
      <th><%=sortable "profitNumber", "Numero de Factura"%> </th>
      <th>Cliente</th>
      <th><%=sortable "paid", "Pagada"%></th>
      <th><%= sortable "date", "Fecha"%></th>
      <th><%= sortable "month", "Mes"%></th>
      <th><%=sortable "amountPaid", "Monto Pagado"%></th>
    <%else%>
      <th><%=sortable "profitNumber", "Numero de Factura"%> </th>
      <th><%=sortable "month", "Mes a Pagar"%></th>
      <th><%=sortable "paid", "Pagada"%></th>
      <th><%= sortable "date", "Fecha"%></th>
      <th><%=sortable "amountPaid", "Monto Pagado"%></th>
    <%end%>
    <th colspan="3"></th>
      
      
      
    </tr>
 

  <tbody>
    <%@accountsNumber = 0%>
    <% @accountreceivables.each do |accountreceivable| %>
      <tr>
      <%client = Client.find(accountreceivable.client_id)%>
      <%accounts = false%>
      <%@clients = Client.all%>
      <%client = Client.find(accountreceivable.client_id)%>
      <%@rate = Rate.find(accountreceivable.rate_id)%>
      
      
        <%client.emails.each do |email|%>
          <%if current_user.email == email.email%>
            <%accounts = true%>

            <%@accountsNumber = @accountsNumber + 1%>
          <%end%>
        <%end%>
      
      
      
       
        <%if current_user.role != "client" or (current_user.role == "client" and accounts) %>

          <%if current_user.role != "client"%>
            <th><%= accountreceivable.profitNumber %></th>
            <td><%= accountreceivable.client.name %></td>
            <th><%= "Si" if accountreceivable.paid %><%= "No" if !accountreceivable.paid %></th>
            <td><%= accountreceivable.date %></td>
            <td><%= accountreceivable.month %></td>
            <td><%= (accountreceivable.amountPaid).to_s.gsub('.', ',') %></td>
          <%else%>
          <th><%= accountreceivable.profitNumber %></th>
            <td><%= accountreceivable.month %></td>
            <td><%= accountreceivable.paid%></td>
            <td><%= accountreceivable.date %></td>
            <td><%= (accountreceivable.amountPaid).to_s.gsub('.', ',') %></td>
          <%end%>
          
          
          
          
          <%if current_user.role != "client" or (current_user.role == "client" and accountreceivable.paid) %>
            <td><%= link_to image_tag('/assets/showeye.ico'), accountreceivable %></td>
          <%end%>
          <%if current_user.role != "client" or (current_user.role == "client" and !accountreceivable.paid) %>
            <td><%= link_to image_tag('/assets/pencil.ico'), edit_accountreceivable_path(accountreceivable) %></td>
          <%end%>
          <%if current_user.role != "client" %>
            <td><%= link_to image_tag('/assets/delete.ico'), accountreceivable, method: :delete, data: { confirm: 'Â¿Estas seguro?' } %></td>
          <%end%>
        
        <%end%>
        
      </tr>
      
    <% end %>
    <%if current_user.role == "client" and @accountsNumber == 0%>
          <td>No Hay Cuentas por Cobrar</td>
    <%end%>

    
  </tbody>
</table>
  <%if current_user.role != "client" %>
    <div align="center">
    <%= will_paginate %>
    </div>
    <br>

    <div ALIGN=right>
    <%= link_to 'Nueva Cuenta', new_accountreceivable_path, :class => 'btn btn-default btn'  %>
    </div>
    <br>
  <%end%>
